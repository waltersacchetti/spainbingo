<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Test - BingoRoyal</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: white;
        }
        .debug-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid #444;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .log-area {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .status.success { background: #28a745; }
        .status.error { background: #dc3545; }
        .status.warning { background: #ffc107; color: #000; }
        .status.info { background: #17a2b8; }
    </style>
</head>
<body>
    <h1>üîß Debug Test - BingoRoyal</h1>
    
    <div class="debug-section">
        <h2>üéÆ Pruebas del Bot√≥n de Jugar</h2>
        <button class="test-button" onclick="testSelectGameMode('NIGHT')">Probar Bot√≥n Jugar NOCTURNO</button>
        <button class="test-button" onclick="testSelectGameMode('CLASSIC')">Probar Bot√≥n Jugar CLASSIC</button>
        <button class="test-button" onclick="testSelectGameMode('RAPID')">Probar Bot√≥n Jugar RAPID</button>
        <button class="test-button" onclick="testSelectGameMode('VIP')">Probar Bot√≥n Jugar VIP</button>
        
        <div id="selectGameModeStatus" class="status info">Estado: Esperando pruebas...</div>
    </div>
    
    <div class="debug-section">
        <h2>üõí Pruebas del Sistema de Compra</h2>
        <button class="test-button" onclick="testBuyCards(1)">Comprar 1 Cart√≥n</button>
        <button class="test-button" onclick="testBuyCards(3)">Comprar 3 Cartones</button>
        <button class="test-button" onclick="testBuyCards(5)">Comprar 5 Cartones</button>
        
        <div id="buyCardsStatus" class="status info">Estado: Esperando pruebas...</div>
    </div>
    
    <div class="debug-section">
        <h2>üîç Estado del Sistema</h2>
        <button class="test-button" onclick="checkSystemStatus()">Verificar Estado del Sistema</button>
        <button class="test-button" onclick="checkGameModes()">Verificar Modos de Juego</button>
        <button class="test-button" onclick="checkUserBalance()">Verificar Saldo del Usuario</button>
        
        <div id="systemStatus" class="status info">Estado: Esperando verificaci√≥n...</div>
    </div>
    
    <div class="debug-section">
        <h2>üìù Logs de Debug</h2>
        <button class="test-button" onclick="clearLogs()">Limpiar Logs</button>
        <button class="test-button" onclick="exportLogs()">Exportar Logs</button>
        
        <div id="debugLogs" class="log-area">Iniciando sistema de debug...\n</div>
    </div>

    <script>
        // Sistema de logging
        function log(message, type = 'info') {
            const logArea = document.getElementById('debugLogs');
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            logArea.textContent += logMessage;
            logArea.scrollTop = logArea.scrollHeight;
            
            // Tambi√©n mostrar en consola
            console.log(`[DEBUG] ${message}`);
        }

        function clearLogs() {
            document.getElementById('debugLogs').textContent = 'Logs limpiados...\n';
        }

        function exportLogs() {
            const logs = document.getElementById('debugLogs').textContent;
            const blob = new Blob([logs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'bingo-debug-logs.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Pruebas del bot√≥n de jugar
        function testSelectGameMode(modeId) {
            log(`üéÆ Probando selectGameMode('${modeId}')...`);
            
            try {
                // Verificar si la funci√≥n existe
                if (typeof selectGameMode !== 'function') {
                    log(`‚ùå ERROR: selectGameMode no es una funci√≥n`, 'error');
                    document.getElementById('selectGameModeStatus').className = 'status error';
                    document.getElementById('selectGameModeStatus').textContent = `ERROR: selectGameMode no es una funci√≥n`;
                    return;
                }

                // Verificar si bingoGame est√° disponible
                if (typeof window.bingoGame === 'undefined') {
                    log(`‚ö†Ô∏è ADVERTENCIA: window.bingoGame no est√° definido`, 'warning');
                } else {
                    log(`‚úÖ window.bingoGame est√° disponible:`, 'success');
                    log(`   - Tipo: ${typeof window.bingoGame}`);
                    log(`   - Constructor: ${window.bingoGame.constructor.name}`);
                }

                // Ejecutar la funci√≥n
                log(`üöÄ Ejecutando selectGameMode('${modeId}')...`);
                const result = selectGameMode(modeId);
                
                log(`‚úÖ selectGameMode('${modeId}') ejecutado. Resultado: ${result}`, 'success');
                document.getElementById('selectGameModeStatus').className = 'status success';
                document.getElementById('selectGameModeStatus').textContent = `‚úÖ selectGameMode('${modeId}') ejecutado exitosamente`;
                
            } catch (error) {
                log(`‚ùå ERROR en selectGameMode('${modeId}'): ${error.message}`, 'error');
                log(`   Stack: ${error.stack}`, 'error');
                document.getElementById('selectGameModeStatus').className = 'status error';
                document.getElementById('selectGameModeStatus').textContent = `‚ùå ERROR: ${error.message}`;
            }
        }

        // Pruebas del sistema de compra
        function testBuyCards(quantity) {
            log(`üõí Probando compra de ${quantity} cart√≥n(es)...`);
            
            try {
                // Verificar si bingoGame est√° disponible
                if (typeof window.bingoGame === 'undefined') {
                    log(`‚ùå ERROR: window.bingoGame no est√° definido`, 'error');
                    document.getElementById('buyCardsStatus').className = 'status error';
                    document.getElementById('buyCardsStatus').textContent = `ERROR: bingoGame no disponible`;
                    return;
                }

                // Verificar si el m√©todo buyCards existe
                if (typeof window.bingoGame.buyCards !== 'function') {
                    log(`‚ùå ERROR: buyCards no es una funci√≥n`, 'error');
                    document.getElementById('buyCardsStatus').className = 'status error';
                    document.getElementById('buyCardsStatus').textContent = `ERROR: buyCards no es una funci√≥n`;
                    return;
                }

                // Verificar modo actual
                const currentMode = window.bingoGame.getCurrentGameMode ? window.bingoGame.getCurrentGameMode() : null;
                log(`üîç Modo actual: ${currentMode ? currentMode.id : 'NO DEFINIDO'}`);

                // Verificar si se pueden comprar cartones
                if (window.bingoGame.canPurchaseCards) {
                    const canPurchase = window.bingoGame.canPurchaseCards(currentMode?.id);
                    log(`üîç ¬øSe pueden comprar cartones? ${canPurchase.canPurchase ? 'S√ç' : 'NO'}`);
                    if (!canPurchase.canPurchase) {
                        log(`   Raz√≥n: ${canPurchase.reason}`);
                    }
                }

                // Ejecutar la compra
                log(`üöÄ Ejecutando buyCards(${quantity})...`);
                const result = window.bingoGame.buyCards(quantity);
                
                log(`‚úÖ buyCards(${quantity}) ejecutado. Resultado: ${result}`, 'success');
                document.getElementById('buyCardsStatus').className = 'status success';
                document.getElementById('buyCardsStatus').textContent = `‚úÖ Compra de ${quantity} cart√≥n(es) ejecutada. Resultado: ${result}`;
                
            } catch (error) {
                log(`‚ùå ERROR en buyCards(${quantity}): ${error.message}`, 'error');
                log(`   Stack: ${error.stack}`, 'error');
                document.getElementById('buyCardsStatus').className = 'status error';
                document.getElementById('buyCardsStatus').textContent = `‚ùå ERROR: ${error.message}`;
            }
        }

        // Verificar estado del sistema
        function checkSystemStatus() {
            log(`üîç Verificando estado del sistema...`);
            
            try {
                const status = {
                    bingoGame: typeof window.bingoGame !== 'undefined',
                    selectGameMode: typeof selectGameMode === 'function',
                    window: typeof window !== 'undefined',
                    document: typeof document !== 'undefined'
                };

                log(`üìä Estado del sistema:`);
                log(`   - window.bingoGame: ${status.bingoGame ? '‚úÖ DISPONIBLE' : '‚ùå NO DISPONIBLE'}`);
                log(`   - selectGameMode: ${status.selectGameMode ? '‚úÖ DISPONIBLE' : '‚ùå NO DISPONIBLE'}`);
                log(`   - window: ${status.window ? '‚úÖ DISPONIBLE' : '‚ùå NO DISPONIBLE'}`);
                log(`   - document: ${status.document ? '‚úÖ DISPONIBLE' : '‚ùå NO DISPONIBLE'}`);

                if (status.bingoGame) {
                    const bingoGame = window.bingoGame;
                    log(`üîç Detalles de bingoGame:`);
                    log(`   - Constructor: ${bingoGame.constructor.name}`);
                    log(`   - M√©todos disponibles: ${Object.getOwnPropertyNames(Object.getPrototypeOf(bingoGame)).join(', ')}`);
                }

                document.getElementById('systemStatus').className = 'status success';
                document.getElementById('systemStatus').textContent = `‚úÖ Estado del sistema verificado`;
                
            } catch (error) {
                log(`‚ùå ERROR al verificar estado del sistema: ${error.message}`, 'error');
                document.getElementById('systemStatus').className = 'status error';
                document.getElementById('systemStatus').textContent = `‚ùå ERROR: ${error.message}`;
            }
        }

        // Verificar modos de juego
        function checkGameModes() {
            log(`üéÆ Verificando modos de juego...`);
            
            try {
                if (typeof window.bingoGame === 'undefined') {
                    log(`‚ùå ERROR: bingoGame no disponible`);
                    return;
                }

                const bingoGame = window.bingoGame;
                
                // Verificar m√©todos relacionados con modos
                if (bingoGame.getAvailableGameModes) {
                    const modes = bingoGame.getAvailableGameModes();
                    log(`üìã Modos de juego disponibles: ${modes.length}`);
                    modes.forEach(mode => {
                        log(`   - ${mode.id}: ${mode.name} (‚Ç¨${mode.cardPrice})`);
                    });
                }

                if (bingoGame.getCurrentGameMode) {
                    const currentMode = bingoGame.getCurrentGameMode();
                    log(`üéØ Modo actual: ${currentMode ? currentMode.id : 'NO DEFINIDO'}`);
                }

                if (bingoGame.gameModes) {
                    log(`üîß gameModes en bingoGame: ${Object.keys(bingoGame.gameModes).join(', ')}`);
                }

                log(`‚úÖ Verificaci√≥n de modos de juego completada`);
                
            } catch (error) {
                log(`‚ùå ERROR al verificar modos de juego: ${error.message}`, 'error');
            }
        }

        // Verificar saldo del usuario
        function checkUserBalance() {
            log(`üí∞ Verificando saldo del usuario...`);
            
            try {
                if (typeof window.bingoGame === 'undefined') {
                    log(`‚ùå ERROR: bingoGame no disponible`);
                    return;
                }

                const bingoGame = window.bingoGame;
                
                if (bingoGame.userBalance !== undefined) {
                    log(`üíµ Saldo del usuario: ‚Ç¨${bingoGame.userBalance}`);
                } else {
                    log(`‚ö†Ô∏è userBalance no est√° definido`);
                }

                if (bingoGame.userCards) {
                    log(`üé´ Cartones del usuario: ${bingoGame.userCards.length}`);
                } else {
                    log(`‚ö†Ô∏è userCards no est√° definido`);
                }

                log(`‚úÖ Verificaci√≥n de saldo completada`);
                
            } catch (error) {
                log(`‚ùå ERROR al verificar saldo: ${error.message}`, 'error');
            }
        }

        // Inicializaci√≥n
        window.addEventListener('load', function() {
            log(`üöÄ P√°gina de debug cargada`);
            log(`üîç Verificando disponibilidad de funciones...`);
            
            // Verificar funciones globales
            if (typeof selectGameMode === 'function') {
                log(`‚úÖ selectGameMode est√° disponible`);
            } else {
                log(`‚ùå selectGameMode NO est√° disponible`);
            }

            // Verificar bingoGame
            if (typeof window.bingoGame !== 'undefined') {
                log(`‚úÖ window.bingoGame est√° disponible`);
            } else {
                log(`‚ùå window.bingoGame NO est√° disponible`);
            }

            log(`üéØ Sistema de debug listo para pruebas`);
        });

        // Interceptar errores globales
        window.addEventListener('error', function(event) {
            log(`üö® ERROR GLOBAL: ${event.message}`, 'error');
            log(`   Archivo: ${event.filename}:${event.lineno}:${event.colno}`, 'error');
        });

        // Interceptar promesas rechazadas
        window.addEventListener('unhandledrejection', function(event) {
            log(`üö® PROMESA RECHAZADA: ${event.reason}`, 'error');
        });
    </script>
    
    <!-- üéØ SCRIPTS NECESARIOS EN ORDEN CORRECTO -->
    <script src="security.js"></script>
    <script src="device-detection.js"></script>
    <script src="mobile-mobile.js"></script>
    <script src="auto-daub-system.js"></script>
    <script src="multi-room-system.js"></script>
    <script src="chat-config.js"></script>
    <script src="advanced-chat-system.js"></script>
    <script src="chat-test.js"></script>
    <script src="premium-sound-system.js"></script>
    <script src="premium-animations.js"></script>
    <script src="advanced-vip-system.js"></script>
    <script src="tournament-system.js"></script>
    <script src="gamification-system.js"></script>
    <script src="social-system.js"></script>
    <script src="seasons-system.js"></script>
    <script src="virtual-currency-system.js"></script>
    
    <!-- üéØ SCRIPT PRINCIPAL DEL JUEGO (DEBE IR AL FINAL) -->
    <script src="script.js"></script>
    
    <!-- üéØ INICIALIZACI√ìN DEL JUEGO DESPU√âS DE CARGAR EL SCRIPT -->
    <script>
        // Esperar a que se cargue el script principal
        window.addEventListener('load', function() {
            // Esperar un poco m√°s para asegurar que script.js se haya cargado
            setTimeout(function() {
                log(`üîß Verificando carga del script principal...`);
                
                if (typeof window.bingoGame !== 'undefined') {
                    log(`‚úÖ bingoGame cargado correctamente`);
                    log(`   - Constructor: ${window.bingoGame.constructor.name}`);
                    log(`   - M√©todos: ${Object.getOwnPropertyNames(Object.getPrototypeOf(window.bingoGame)).length} m√©todos disponibles`);
                } else {
                    log(`‚ùå bingoGame NO se carg√≥ correctamente`);
                }
                
                if (typeof selectGameMode === 'function') {
                    log(`‚úÖ selectGameMode cargado correctamente`);
                } else {
                    log(`‚ùå selectGameMode NO se carg√≥ correctamente`);
                }
                
                log(`üéØ Sistema de debug completamente inicializado`);
            }, 2000); // Esperar 2 segundos
        });
    </script>
</body>
</html>
