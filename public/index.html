<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpainBingo - Jugar Bingo Online</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="auth.js"></script>
    <script src="security.js"></script>
    <script>
        // Redirigir automÃ¡ticamente a la pÃ¡gina de bienvenida si es la primera visita
        document.addEventListener('DOMContentLoaded', function() {
            const hasVisitedWelcome = localStorage.getItem('spainbingo_welcome_visited');
            
            // Verificar edad antes de continuar
            if (!securityManager.verifyAge()) {
                return;
            }
            
            // Verificar auto-exclusiÃ³n
            if (securityManager.responsibleGaming.selfExclusion.checkExclusion()) {
                alert('Usted tiene una auto-exclusiÃ³n activa. No puede acceder al juego.');
                window.location.href = 'welcome.html';
                return;
            }
            
            // Si no ha visitado la pÃ¡gina de bienvenida, redirigir
            if (!hasVisitedWelcome) {
                window.location.href = 'welcome.html';
            }
        });
    </script>
</head>
<body>
    <div class="app-container">
        <!-- Header Profesional -->
        <header class="main-header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo">
                        <i class="fas fa-dice"></i>
                        <span>SpainBingo</span>
                    </div>
                    <div class="tagline">El Rey del Bingo Online</div>
                    <div class="welcome-message">Â¡Bienvenido al mejor Bingo de EspaÃ±a! ðŸŽ¯</div>
                </div>
                
                <div class="user-section">
                    <div class="user-info">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="user-details">
                            <div class="username">Jugador</div>
                            <div class="user-level">Nivel 1</div>
                        </div>
                        <button class="btn-logout" onclick="logout()" title="Cerrar sesiÃ³n">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                    
                    <div class="balance-section">
                        <div class="balance">
                            <i class="fas fa-coins"></i>
                            <span id="userBalance">â‚¬50.00</span>
                        </div>
                        <button class="btn-deposit">
                            <i class="fas fa-plus"></i>
                            Depositar
                        </button>
                    </div>
                </div>
                
                <!-- BotÃ³n discreto para resetear experiencia (solo para desarrollo) -->
                <button class="btn-reset-welcome" onclick="resetWelcomeExperience()" title="Resetear experiencia de bienvenida">
                    <i class="fas fa-redo"></i>
                </button>
            </div>
        </header>

        <!-- Chat Desplegable - PosiciÃ³n Fija -->
        <div class="chat-toggle-section-fixed">
            <button class="chat-toggle-btn-fixed" onclick="toggleChat()">
                <i class="fas fa-comments"></i>
                <span>Chat en Vivo</span>
                <i class="fas fa-chevron-down toggle-icon"></i>
            </button>
        </div>
        
        <div class="chat-section-fixed" id="chatSectionFixed">
            <div class="chat-container">
                                                <div class="chat-messages" id="chatMessages">
                                    <div class="chat-message system">
                                        <span class="message-time">15:30</span>
                                        <span class="message-text">Â¡Bienvenido al BingoPro!</span>
                                    </div>
                                    <div class="chat-message bot">
                                        <span class="message-time">15:31</span>
                                        <span class="message-user">BingoBot:</span>
                                        <span class="message-text">Â¡Hola! Â¡Bienvenido al mejor Bingo de EspaÃ±a! ðŸŽ¯</span>
                                    </div>
                                    <div class="chat-message bot">
                                        <span class="message-time">15:32</span>
                                        <span class="message-user">BingoBot:</span>
                                        <span class="message-text">Escribe "ayuda" para ver las opciones disponibles ðŸ’¬</span>
                                    </div>
                                    <div class="chat-message">
                                        <span class="message-time">15:33</span>
                                        <span class="message-user">MarÃ­a:</span>
                                        <span class="message-text">Â¡Buena suerte a todos!</span>
                                    </div>
                                    <div class="chat-message">
                                        <span class="message-time">15:34</span>
                                        <span class="message-user">Carlos:</span>
                                        <span class="message-text">Casi tengo lÃ­nea ðŸ˜„</span>
                                    </div>
                                    <div class="chat-message">
                                        <span class="message-time">15:35</span>
                                        <span class="message-user">Ana:</span>
                                        <span class="message-text">Â¿CuÃ¡les son los premios de hoy?</span>
                                    </div>
                                </div>
                <div class="chat-input">
                    <input type="text" placeholder="Escribe un mensaje..." id="chatInput" onkeypress="if(event.key==='Enter') sendChatMessage()">
                    <button class="btn-send" onclick="sendChatMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Barra de NavegaciÃ³n -->
        <nav class="main-nav">
            <div class="nav-content">
                <div class="nav-tabs">
                    <button class="nav-tab active" data-tab="game">
                        <i class="fas fa-gamepad"></i>
                        Jugar
                    </button>
                    <button class="nav-tab" data-tab="cards">
                        <i class="fas fa-ticket-alt"></i>
                        Mis Cartones
                    </button>
                    <button class="nav-tab" data-tab="shop">
                        <i class="fas fa-shopping-cart"></i>
                        Comprar Cartones
                    </button>
                    <button class="nav-tab" data-tab="history">
                        <i class="fas fa-history"></i>
                        Historial
                    </button>
                    <button class="nav-tab" data-tab="analytics" onclick="window.open('analytics.html', '_blank')">
                        <i class="fas fa-chart-line"></i>
                        Analytics
                    </button>
                </div>
                
                <div class="game-status">
                    <div class="status-item">
                        <i class="fas fa-users"></i>
                        <span id="activePlayers">1,247</span> jugadores
                    </div>
                    <div class="status-item">
                        <i class="fas fa-trophy"></i>
                        <span id="currentPrize">â‚¬500</span> premio
                    </div>
                    <div class="status-item game-countdown">
                        <i class="fas fa-clock"></i>
                        <span>PrÃ³xima partida: <span id="gameCountdown">2:00</span></span>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Contenido Principal -->
        <main class="main-content">
            <!-- PestaÃ±a de Juego -->
            <div class="tab-content active" id="game-tab">
                <div class="game-layout">
                    <!-- Panel Izquierdo - NÃºmeros Llamados -->
                    <div class="left-panel">
                        <div class="panel-header">
                            <h3><i class="fas fa-bullhorn"></i> NÃºmeros Llamados</h3>
                            <div class="caller-controls">
                                <button class="btn-call">
                                    <i class="fas fa-dice"></i>
                                    Llamar
                                </button>
                                <button class="btn-auto">
                                    <i class="fas fa-play"></i>
                                    Auto
                                </button>
                                <button class="btn-view-numbers">
                                    <i class="fas fa-eye"></i>
                                    Ver
                                </button>
                            </div>
                        </div>
                        

                        
                        <div class="numbers-grid">
                            <div id="calledNumbers" class="numbers-container">
                                <!-- Los nÃºmeros se generarÃ¡n dinÃ¡micamente -->
                            </div>
                        </div>
                        
                        <div class="last-number-section">
                            <div class="last-number-label">Ãšltimo NÃºmero</div>
                            <div id="lastNumber" class="last-number-display">-</div>
                        </div>
                    </div>

                    <!-- Panel Central - Cartones -->
                    <div class="center-panel">
                        <div class="panel-header">
                            <h3><i class="fas fa-ticket-alt"></i> Mis Cartones</h3>
                        </div>
                        
                        <!-- Panel de Noticias y PrÃ³ximos Premios -->
                        <div class="news-section">
                            <div class="news-header">
                                <h4><i class="fas fa-newspaper"></i> Noticias y PrÃ³ximos Premios</h4>
                            </div>
                            <div class="news-content" id="newsContent">
                                <!-- El contenido se generarÃ¡ dinÃ¡micamente -->
                            </div>
                        </div>
                        
                        <!-- Analytics Display -->
                        <div class="analytics-section">
                            <div class="analytics-header">
                                <h4><i class="fas fa-chart-line"></i> Mis EstadÃ­sticas</h4>
                            </div>
                            <div id="analytics-display" class="analytics-content">
                                <!-- Analytics will be populated dynamically -->
                            </div>
                        </div>
                        
                        <!-- Sistema de Compra de Cartones -->
                        <div class="card-purchase-section">
                            <div class="purchase-info">
                                <div class="price-info">
                                    <i class="fas fa-euro-sign"></i>
                                    <span>â‚¬1.00 por cartÃ³n</span>
                                </div>
                                <div class="selected-cards">
                                    <span id="selectedCardsCount">0</span> cartones seleccionados
                                </div>
                            </div>
                            
                            <div class="purchase-controls">
                                <div class="quantity-selector">
                                    <button class="btn-quantity" onclick="changeQuantity(-1)">-</button>
                                    <input type="number" id="cardQuantity" value="1" min="1" max="20">
                                    <button class="btn-quantity" onclick="changeQuantity(1)">+</button>
                                </div>
                                <button class="btn-buy-cards" onclick="buySelectedCards()">
                                    <i class="fas fa-shopping-cart"></i>
                                    Comprar Cartones
                                </button>
                                <button class="btn-join-game" onclick="joinCurrentGame()" id="joinGameBtn" disabled>
                                    <i class="fas fa-play"></i>
                                    Unirse a la Partida
                                </button>
                            </div>
                        </div>
                        
                        <div class="cards-container">
                            <div id="bingoCards" class="cards-grid">
                                <!-- Los cartones se generarÃ¡n dinÃ¡micamente -->
                            </div>
                        </div>
                    </div>

                    <!-- Panel Derecho - EstadÃ­sticas y Chat -->
                    <div class="right-panel">
                        <!-- InformaciÃ³n de Premios en Lateral Derecho -->
                        <div class="side-prize-info">
                            <div class="prize-section">
                                <div class="main-prize">
                                    <i class="fas fa-trophy"></i>
                                    <span id="currentPrizeRight">â‚¬500</span>
                                    <span class="prize-label">premio total</span>
                                </div>
                                <div id="prizeInfoRight" class="prize-breakdown">
                                    <!-- InformaciÃ³n detallada de premios se mostrarÃ¡ aquÃ­ -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="stats-section">
                            <div class="panel-header">
                                <h3><i class="fas fa-chart-bar"></i> EstadÃ­sticas</h3>
                            </div>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-dice"></i>
                                    </div>
                                    <div class="stat-info">
                                        <div class="stat-value" id="numbersCalled">0</div>
                                        <div class="stat-label">Llamados</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <div class="stat-info">
                                        <div class="stat-value" id="numbersMarked">0</div>
                                        <div class="stat-label">Marcados</div>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-trophy"></i>
                                    </div>
                                    <div class="stat-info">
                                        <div class="stat-value" id="linesCompleted">0</div>
                                        <div class="stat-label">LÃ­neas</div>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
            </div>

            <!-- PestaÃ±a de Mis Cartones -->
            <div class="tab-content" id="cards-tab">
                <div class="my-cards-section">
                    <div class="section-header">
                        <h2>Mis Cartones</h2>
                        <div class="cards-summary">
                            <div class="summary-item">
                                <span class="summary-value" id="totalCards">3</span>
                                <span class="summary-label">Cartones</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-value" id="activeCards">2</span>
                                <span class="summary-label">Activos</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="cards-list" id="myCardsList">
                        <!-- Los cartones se mostrarÃ¡n aquÃ­ -->
                    </div>
                </div>
            </div>

            <!-- PestaÃ±a de Comprar Cartones -->
            <div class="tab-content" id="shop-tab">
                <div class="shop-section">
                    <div class="section-header">
                        <h2>Comprar Cartones</h2>
                        <p>Selecciona el paquete que prefieras</p>
                    </div>
                    
                    <div class="packages-grid">
                        <div class="package-card">
                            <div class="package-header">
                                <h3>Paquete BÃ¡sico</h3>
                                <div class="package-price">â‚¬2.50</div>
                            </div>
                            <div class="package-features">
                                <div class="feature">
                                    <i class="fas fa-check"></i>
                                    <span>1 CartÃ³n</span>
                                </div>
                                <div class="feature">
                                    <i class="fas fa-check"></i>
                                    <span>VÃ¡lido 24h</span>
                                </div>
                            </div>
                            <button class="btn-buy" data-package="basic">
                                Comprar
                            </button>
                        </div>

                        <div class="package-card popular">
                            <div class="popular-badge">MÃ¡s Popular</div>
                            <div class="package-header">
                                <h3>Paquete Premium</h3>
                                <div class="package-price">â‚¬8.00</div>
                            </div>
                            <div class="package-features">
                                <div class="feature">
                                    <i class="fas fa-check"></i>
                                    <span>5 Cartones</span>
                                </div>
                                <div class="feature">
                                    <i class="fas fa-check"></i>
                                    <span>VÃ¡lido 7 dÃ­as</span>
                                </div>
                                <div class="feature">
                                    <i class="fas fa-check"></i>
                                    <span>+20% premios</span>
                                </div>
                            </div>
                            <button class="btn-buy" data-package="premium">
                                Comprar
                            </button>
                        </div>

                        <div class="package-card">
                            <div class="package-header">
                                <h3>Paquete VIP</h3>
                                <div class="package-price">â‚¬15.00</div>
                            </div>
                            <div class="package-features">
                                <div class="feature">
                                    <i class="fas fa-check"></i>
                                    <span>12 Cartones</span>
                                </div>
                                <div class="feature">
                                    <i class="fas fa-check"></i>
                                    <span>VÃ¡lido 30 dÃ­as</span>
                                </div>
                                <div class="feature">
                                    <i class="fas fa-check"></i>
                                    <span>+50% premios</span>
                                </div>
                                <div class="feature">
                                    <i class="fas fa-check"></i>
                                    <span>Chat VIP</span>
                                </div>
                            </div>
                            <button class="btn-buy" data-package="vip">
                                Comprar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PestaÃ±a de Historial -->
            <div class="tab-content" id="history-tab">
                <div class="history-section">
                    <div class="section-header">
                        <h2>Historial de Juegos</h2>
                    </div>
                    
                    <div class="history-filters">
                        <button class="filter-btn active" data-filter="all">Todos</button>
                        <button class="filter-btn" data-filter="wins">Victorias</button>
                        <button class="filter-btn" data-filter="purchases">Compras</button>
                    </div>
                    
                    <div class="history-list" id="historyList">
                        <!-- El historial se mostrarÃ¡ aquÃ­ -->
                    </div>
                </div>
            </div>
        </main>

        <!-- Modales -->
        <div id="depositModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Depositar Fondos</h3>
                    <button class="modal-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="payment-methods">
                        <div class="payment-method active" data-method="card">
                            <i class="fas fa-credit-card"></i>
                            <span>Tarjeta de CrÃ©dito</span>
                        </div>
                        <div class="payment-method" data-method="paypal">
                            <i class="fab fa-paypal"></i>
                            <span>PayPal</span>
                        </div>
                    </div>
                    
                    <div class="amount-selector">
                        <label>Monto a depositar:</label>
                        <div class="amount-options">
                            <button class="amount-btn" data-amount="10">â‚¬10</button>
                            <button class="amount-btn" data-amount="25">â‚¬25</button>
                            <button class="amount-btn" data-amount="50">â‚¬50</button>
                            <button class="amount-btn" data-amount="100">â‚¬100</button>
                        </div>
                        <div class="custom-amount">
                            <input type="number" placeholder="Otro monto" id="customAmount" min="5" max="1000">
                        </div>
                    </div>
                    
                    <div class="payment-form">
                        <div class="form-group">
                            <label>NÃºmero de tarjeta</label>
                            <input type="text" placeholder="1234 5678 9012 3456" id="cardNumber">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Fecha de expiraciÃ³n</label>
                                <input type="text" placeholder="MM/AA" id="cardExpiry">
                            </div>
                            <div class="form-group">
                                <label>CVV</label>
                                <input type="text" placeholder="123" id="cardCvv">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-cancel">Cancelar</button>
                    <button class="btn-confirm">Depositar â‚¬<span id="depositAmount">25</span></button>
                </div>
            </div>
        </div>

        <div id="winModal" class="modal">
            <div class="modal-content win-modal">
                <div class="modal-header">
                    <h3>Â¡Felicidades!</h3>
                </div>
                <div class="modal-body">
                    <div class="win-animation">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="win-details" id="winDetails">
                        <!-- Los detalles de la victoria se mostrarÃ¡n aquÃ­ -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-confirm">Continuar</button>
                </div>
            </div>
        </div>

        <!-- Modal de NÃºmeros Llamados -->
        <div id="calledNumbersModal" class="modal">
            <div class="modal-content called-numbers-modal">
                <div class="modal-header">
                    <h3><i class="fas fa-bullhorn"></i> NÃºmeros Llamados</h3>
                    <button class="modal-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="called-numbers-summary">
                        <div class="summary-stats">
                            <div class="stat-item">
                                <span class="stat-label">Total Llamados:</span>
                                <span class="stat-value" id="modalTotalCalled">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Ãšltimo NÃºmero:</span>
                                <span class="stat-value" id="modalLastNumber">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">NÃºmeros Restantes:</span>
                                <span class="stat-value" id="modalRemaining">90</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="called-numbers-grid">
                        <div class="numbers-section">
                            <h4>NÃºmeros del 1-30</h4>
                            <div class="numbers-row" id="numbers1-30"></div>
                        </div>
                        <div class="numbers-section">
                            <h4>NÃºmeros del 31-60</h4>
                            <div class="numbers-row" id="numbers31-60"></div>
                        </div>
                        <div class="numbers-section">
                            <h4>NÃºmeros del 61-90</h4>
                            <div class="numbers-row" id="numbers61-90"></div>
                        </div>
                    </div>
                    
                    <div class="called-numbers-list">
                        <h4>Historial de Llamadas</h4>
                        <div class="called-list" id="calledNumbersList">
                            <!-- Los nÃºmeros llamados se mostrarÃ¡n aquÃ­ en orden cronolÃ³gico -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-confirm">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html> 