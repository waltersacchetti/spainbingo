<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ Test SincronizaciÃ³n - BingoRoyal</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .test-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #4ecdc4;
        }
        
        .test-button {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4);
        }
        
        .test-button.danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        }
        
        .test-button.success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        
        .status-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 4px;
        }
        
        .log-info { background: rgba(78, 205, 196, 0.2); }
        .log-success { background: rgba(46, 204, 113, 0.2); }
        .log-warning { background: rgba(241, 196, 15, 0.2); }
        .log-error { background: rgba(231, 76, 60, 0.2); }
        
        .sync-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .status-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .status-value {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .status-label {
            font-size: 14px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Test SincronizaciÃ³n - BingoRoyal</h1>
        <p>Esta pÃ¡gina permite probar las correcciones de sincronizaciÃ³n implementadas.</p>
        
        <!-- Estado del Sistema -->
        <div class="test-section">
            <div class="test-title">ğŸ“Š Estado del Sistema</div>
            <div class="sync-status">
                <div class="status-card">
                    <div class="status-label">Estado del Juego</div>
                    <div class="status-value" id="gameStateStatus">â“</div>
                </div>
                <div class="status-card">
                    <div class="status-label">NÃºmeros Llamados</div>
                    <div class="status-value" id="calledNumbersStatus">â“</div>
                </div>
                <div class="status-card">
                    <div class="status-label">Modo Actual</div>
                    <div class="status-value" id="currentModeStatus">â“</div>
                </div>
                <div class="status-card">
                    <div class="status-label">SincronizaciÃ³n</div>
                    <div class="status-value" id="syncStatus">â“</div>
                </div>
            </div>
        </div>
        
        <!-- Tests de SincronizaciÃ³n -->
        <div class="test-section">
            <div class="test-title">ğŸ”„ Tests de SincronizaciÃ³n</div>
            
            <button class="test-button success" onclick="testFullSync()">
                ğŸ”„ SincronizaciÃ³n Completa
            </button>
            
            <button class="test-button" onclick="testCalledNumbersSync()">
                ğŸ¯ Sincronizar NÃºmeros Llamados
            </button>
            
            <button class="test-button" onclick="testGameStateSync()">
                ğŸ® Sincronizar Estado del Juego
            </button>
            
            <button class="test-button" onclick="testCountdownSync()">
                â° Sincronizar Countdowns
            </button>
            
            <button class="test-button danger" onclick="clearAllData()">
                ğŸ—‘ï¸ Limpiar Todos los Datos
            </button>
        </div>
        
        <!-- Tests de Estado -->
        <div class="test-section">
            <div class="test-title">ğŸ” Tests de Estado</div>
            
            <button class="test-button" onclick="checkPurchaseState()">
                ğŸ›’ Verificar Estado de Compra
            </button>
            
            <button class="test-button" onclick="checkServerState()">
                ğŸŒ Verificar Estado del Servidor
            </button>
            
            <button class="test-button" onclick="checkModeCycles()">
                ğŸ”„ Verificar Ciclos de Modo
            </button>
            
            <button class="test-button" onclick="checkCalledNumbers()">
                ğŸ“Š Verificar NÃºmeros Llamados
            </button>
        </div>
        
        <!-- Log de Eventos -->
        <div class="test-section">
            <div class="test-title">ğŸ“ Log de Eventos</div>
            <div class="status-display" id="eventLog">
                <div class="log-entry log-info">âœ… Sistema de test cargado correctamente</div>
                <div class="log-entry log-info">ğŸ”§ Esperando acciones del usuario...</div>
            </div>
            <button class="test-button" onclick="clearLog()">ğŸ—‘ï¸ Limpiar Log</button>
        </div>
    </div>

    <script>
        // Sistema de logging
        function log(message, type = 'info') {
            const logContainer = document.getElementById('eventLog');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('eventLog').innerHTML = '';
            log('Log limpiado', 'info');
        }
        
        // FunciÃ³n principal de test
        async function testFullSync() {
            log('ğŸ”„ Iniciando sincronizaciÃ³n completa...', 'info');
            
            try {
                if (window.bingoGame && window.bingoGame.forceFullSynchronization) {
                    await window.bingoGame.forceFullSynchronization();
                    log('âœ… SincronizaciÃ³n completa exitosa', 'success');
                    updateStatus();
                } else {
                    log('âŒ FunciÃ³n forceFullSynchronization no disponible', 'error');
                }
            } catch (error) {
                log(`âŒ Error en sincronizaciÃ³n completa: ${error.message}`, 'error');
            }
        }
        
        async function testCalledNumbersSync() {
            log('ğŸ¯ Sincronizando nÃºmeros llamados...', 'info');
            
            try {
                if (window.bingoGame && window.bingoGame.syncCalledNumbersWithServer) {
                    await window.bingoGame.syncCalledNumbersWithServer();
                    log('âœ… NÃºmeros llamados sincronizados', 'success');
                    updateStatus();
                } else {
                    log('âŒ FunciÃ³n syncCalledNumbersWithServer no disponible', 'error');
                }
            } catch (error) {
                log(`âŒ Error sincronizando nÃºmeros llamados: ${error.message}`, 'error');
            }
        }
        
        async function testGameStateSync() {
            log('ğŸ® Sincronizando estado del juego...', 'info');
            
            try {
                if (window.bingoGame && window.bingoGame.syncGameStateWithServer) {
                    await window.bingoGame.syncGameStateWithServer();
                    log('âœ… Estado del juego sincronizado', 'success');
                    updateStatus();
                } else {
                    log('âŒ FunciÃ³n syncGameStateWithServer no disponible', 'error');
                }
            } catch (error) {
                log(`âŒ Error sincronizando estado del juego: ${error.message}`, 'error');
            }
        }
        
        async function testCountdownSync() {
            log('â° Sincronizando countdowns...', 'info');
            
            try {
                if (window.bingoGame && window.bingoGame.updateAllModeCountdownsCoordinated) {
                    await window.bingoGame.updateAllModeCountdownsCoordinated();
                    log('âœ… Countdowns sincronizados', 'success');
                    updateStatus();
                } else {
                    log('âŒ FunciÃ³n updateAllModeCountdownsCoordinated no disponible', 'error');
                }
            } catch (error) {
                log(`âŒ Error sincronizando countdowns: ${error.message}`, 'error');
            }
        }
        
        function checkPurchaseState() {
            log('ğŸ›’ Verificando estado de compra...', 'info');
            
            if (window.bingoGame) {
                const currentMode = window.bingoGame.getCurrentGameMode();
                if (currentMode) {
                    const canPurchase = window.bingoGame.canPurchaseCards(currentMode.id);
                    log(`ğŸ“Š Modo: ${currentMode.name}`, 'info');
                    log(`ğŸ“Š Puede comprar: ${canPurchase.canPurchase}`, canPurchase.canPurchase ? 'success' : 'warning');
                    log(`ğŸ“Š RazÃ³n: ${canPurchase.reason}`, 'info');
                } else {
                    log('âŒ No se pudo obtener modo actual', 'error');
                }
            } else {
                log('âŒ BingoGame no disponible', 'error');
            }
        }
        
        function checkServerState() {
            log('ğŸŒ Verificando estado del servidor...', 'info');
            
            if (window.bingoGame) {
                const serverState = window.bingoGame.serverGameState;
                if (serverState) {
                    log(`ğŸ“Š Estado del servidor: ${JSON.stringify(serverState, null, 2)}`, 'info');
                } else {
                    log('âš ï¸ No hay estado del servidor', 'warning');
                }
            } else {
                log('âŒ BingoGame no disponible', 'error');
            }
        }
        
        function checkModeCycles() {
            log('ğŸ”„ Verificando ciclos de modo...', 'info');
            
            if (window.bingoGame) {
                const modeCycles = window.bingoGame.modeCycles;
                if (modeCycles) {
                    log(`ğŸ“Š Ciclos de modo: ${JSON.stringify(modeCycles, null, 2)}`, 'info');
                } else {
                    log('âš ï¸ No hay ciclos de modo', 'warning');
                }
            } else {
                log('âŒ BingoGame no disponible', 'error');
            }
        }
        
        function checkCalledNumbers() {
            log('ğŸ“Š Verificando nÃºmeros llamados...', 'info');
            
            if (window.bingoGame) {
                const calledNumbers = window.bingoGame.calledNumbers;
                if (calledNumbers) {
                    log(`ğŸ“Š Cantidad de nÃºmeros llamados: ${calledNumbers.size}`, 'info');
                    log(`ğŸ“Š NÃºmeros: ${Array.from(calledNumbers).join(', ')}`, 'info');
                } else {
                    log('âš ï¸ No hay nÃºmeros llamados', 'warning');
                }
            } else {
                log('âŒ BingoGame no disponible', 'error');
            }
        }
        
        function clearAllData() {
            log('ğŸ—‘ï¸ Limpiando todos los datos...', 'warning');
            
            if (window.bingoGame) {
                try {
                    // Limpiar nÃºmeros llamados
                    if (window.bingoGame.calledNumbers) {
                        window.bingoGame.calledNumbers.clear();
                    }
                    
                    // Resetear estado del juego
                    if (window.bingoGame.forceGameStateSync) {
                        window.bingoGame.forceGameStateSync();
                    }
                    
                    log('âœ… Datos limpiados correctamente', 'success');
                    updateStatus();
                } catch (error) {
                    log(`âŒ Error limpiando datos: ${error.message}`, 'error');
                }
            } else {
                log('âŒ BingoGame no disponible', 'error');
            }
        }
        
        function updateStatus() {
            if (window.bingoGame) {
                // Estado del juego
                const gameState = window.bingoGame.gameState || 'unknown';
                document.getElementById('gameStateStatus').textContent = gameState.toUpperCase();
                
                // NÃºmeros llamados
                const calledCount = window.bingoGame.calledNumbers ? window.bingoGame.calledNumbers.size : 0;
                document.getElementById('calledNumbersStatus').textContent = calledCount;
                
                // Modo actual
                const currentMode = window.bingoGame.getCurrentGameMode();
                const modeName = currentMode ? currentMode.name : 'N/A';
                document.getElementById('currentModeStatus').textContent = modeName;
                
                // Estado de sincronizaciÃ³n
                const hasServerState = !!(window.bingoGame.serverGameState && Object.keys(window.bingoGame.serverGameState).length > 0);
                document.getElementById('syncStatus').textContent = hasServerState ? 'âœ…' : 'âŒ';
            }
        }
        
        // InicializaciÃ³n
        window.addEventListener('load', () => {
            log('ğŸš€ PÃ¡gina de test cargada', 'success');
            
            // Verificar si BingoGame estÃ¡ disponible
            if (window.bingoGame) {
                log('âœ… BingoGame detectado', 'success');
                updateStatus();
            } else {
                log('âš ï¸ BingoGame no detectado - carga la pÃ¡gina principal primero', 'warning');
            }
            
            // Actualizar estado cada 5 segundos
            setInterval(updateStatus, 5000);
        });
        
        // Comandos de debug en consola
        window.testSync = {
            fullSync: testFullSync,
            calledNumbersSync: testCalledNumbersSync,
            gameStateSync: testGameStateSync,
            countdownSync: testCountdownSync,
            checkPurchase: checkPurchaseState,
            checkServer: checkServerState,
            checkModes: checkModeCycles,
            checkNumbers: checkCalledNumbers,
            clearData: clearAllData,
            updateStatus: updateStatus
        };
        
        log('ğŸ”§ Comandos de test disponibles en window.testSync', 'info');
        log('ğŸ”§ TambiÃ©n puedes usar la consola del navegador', 'info');
    </script>
</body>
</html>
