<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <title>Mi Perfil - BingoRoyal</title>
    
    <!-- Estilos base y responsivos -->
    <link rel="stylesheet" href="styles-codere.css">
    <link rel="stylesheet" href="mobile-optimizations.css">
    <link rel="stylesheet" href="adaptive-styles.css">
    
    <!-- Fuentes premium -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PREMIUM THEME v3.0 - Sistema visual avanzado -->
    <link rel="stylesheet" href="premium-theme.css">
    
    <!-- Correcci√≥n espec√≠fica para user-info -->
    <link rel="stylesheet" href="user-fix.css">
    <link rel="stylesheet" href="game-improvements.css">
    <style>
        .profile-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
        }

        .profile-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
            border: 4px solid rgba(255, 255, 255, 0.3);
        }

        .profile-name {
            font-size: 2.5em;
            color: #fff;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .profile-status {
            display: inline-block;
            padding: 8px 20px;
            background: linear-gradient(45deg, #00d4aa, #0099cc);
            color: white;
            border-radius: 25px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .profile-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .profile-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            font-size: 24px;
            color: white;
        }

        .card-title {
            font-size: 1.5em;
            color: #fff;
            font-weight: bold;
        }

        .profile-info {
            display: grid;
            gap: 15px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-label {
            color: #ccc;
            font-weight: 500;
        }

        .info-value {
            color: #fff;
            font-weight: bold;
            text-align: right;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-number {
            font-size: 2em;
            color: #4ecdc4;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #ccc;
            font-size: 0.9em;
        }

        .edit-button {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s ease;
            margin-top: 20px;
        }

        .edit-button:hover {
            transform: scale(1.05);
        }

        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.3s ease;
        }

        .back-button:hover {
            background: rgba(0, 0, 0, 0.9);
        }

        @media (max-width: 768px) {
            .profile-grid {
                grid-template-columns: 1fr;
            }
            
            .profile-name {
                font-size: 2em;
            }
            
            .profile-container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Preloader para evitar pantalla negra -->
    <div class="page-preloader" id="pagePreloader">
        <div class="preloader-content">
            <div class="preloader-spinner"></div>
            <div class="preloader-text">Cargando Perfil...</div>
        </div>
    </div>
    
    <div class="app-container">
        <!-- Bot√≥n de volver al juego -->
        <a href="index.html" class="back-button">
            <i class="fas fa-arrow-left"></i>
            Volver al Juego
        </a>

    <div class="profile-container">
        <!-- HEADER DEL PERFIL -->
        <div class="profile-header">
            <div class="profile-avatar">
                <i class="fas fa-user"></i>
            </div>
            <h1 class="profile-name" id="profileName">Cargando...</h1>
            <div class="profile-status" id="profileStatus">Cargando...</div>
        </div>

        <!-- GRID DE INFORMACI√ìN -->
        <div class="profile-grid">
            <!-- INFORMACI√ìN PERSONAL -->
            <div class="profile-card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <h2 class="card-title">Informaci√≥n Personal</h2>
                </div>
                <div class="profile-info">
                    <div class="info-item">
                        <span class="info-label">Usuario ID:</span>
                        <span class="info-value" id="userId">--</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Nivel:</span>
                        <span class="info-value" id="userLevel">--</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Experiencia:</span>
                        <span class="info-value" id="userExp">--</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Estado VIP:</span>
                        <span class="info-value" id="userVip">--</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Fecha de Registro:</span>
                        <span class="info-value" id="userRegDate">--</span>
                    </div>
                </div>
            </div>

            <!-- ESTAD√çSTICAS DEL JUEGO -->
            <div class="profile-card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h2 class="card-title">Estad√≠sticas del Juego</h2>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="totalGames">0</div>
                        <div class="stat-label">Partidas Jugadas</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="totalWins">0</div>
                        <div class="stat-label">Victorias</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="winRate">0%</div>
                        <div class="stat-label">Tasa de Victoria</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="totalCards">0</div>
                        <div class="stat-label">Cartones Comprados</div>
                    </div>
                </div>
            </div>

            <!-- INFORMACI√ìN FINANCIERA -->
            <div class="profile-card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <h2 class="card-title">Informaci√≥n Financiera</h2>
                </div>
                <div class="profile-info">
                    <div class="info-item">
                        <span class="info-label">Saldo Actual:</span>
                        <span class="info-value" id="userBalance">‚Ç¨0.00</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Total Gastado:</span>
                        <span class="info-value" id="totalSpent">‚Ç¨0.00</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Total Ganado:</span>
                        <span class="info-value" id="totalWon">‚Ç¨0.00</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Beneficio Neto:</span>
                        <span class="info-value" id="netProfit">‚Ç¨0.00</span>
                    </div>
                </div>
            </div>

            <!-- CARTONES POR MODO -->
            <div class="profile-card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-ticket-alt"></i>
                    </div>
                    <h2 class="card-title">Cartones por Modo</h2>
                </div>
                <div class="profile-info" id="cardsByMode">
                    <div class="info-item">
                        <span class="info-label">Cl√°sico:</span>
                        <span class="info-value">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">R√°pido:</span>
                        <span class="info-value">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">VIP:</span>
                        <span class="info-value">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Nocturno:</span>
                        <span class="info-value">0</span>
                    </div>
                </div>
            </div>

            <!-- LOGROS Y PREMIOS -->
            <div class="profile-card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <h2 class="card-title">Logros y Premios</h2>
                </div>
                <div class="profile-info" id="achievements">
                    <div class="info-item">
                        <span class="info-label">Logros Desbloqueados:</span>
                        <span class="info-value" id="achievementsUnlocked">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Premio M√°s Alto:</span>
                        <span class="info-value" id="highestPrize">‚Ç¨0.00</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Racha Actual:</span>
                        <span class="info-value" id="currentStreak">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Mejor Racha:</span>
                        <span class="info-value" id="bestStreak">0</span>
                    </div>
                </div>
            </div>

            <!-- CONFIGURACI√ìN -->
            <div class="profile-card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-cog"></i>
                    </div>
                    <h2 class="card-title">Configuraci√≥n</h2>
                </div>
                <div class="profile-info">
                    <div class="info-item">
                        <span class="info-label">Notificaciones:</span>
                        <span class="info-value">
                            <label class="switch">
                                <input type="checkbox" id="notificationsToggle" checked>
                                <span class="slider round"></span>
                            </label>
                        </span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Sonidos:</span>
                        <span class="info-value">
                            <label class="switch">
                                <input type="checkbox" id="soundsToggle" checked>
                                <span class="slider round"></span>
                            </label>
                        </span>
                    </div>
                    <button class="edit-button" onclick="saveSettings()">
                        <i class="fas fa-save"></i>
                        Guardar Configuraci√≥n
                    </button>
                </div>
            </div>
        </div>
    </div>
    </div> <!-- Cierre de app-container -->

    <script>
        // üö® PRUEBA SIMPLE DE JAVASCRIPT
        alert('üö® JAVASCRIPT FUNCIONA - P√ÅGINA CARGADA');
        console.log('üö® JAVASCRIPT FUNCIONA - P√ÅGINA CARGADA');
    </script>
    <script src="security.js"></script>
    <script src="script.js"></script>
    <script>
        // Inicializar perfil cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            initializeProfile();
            
            // Ocultar preloader
            const preloader = document.getElementById('pagePreloader');
            if (preloader) {
                setTimeout(() => {
                    preloader.style.display = 'none';
                }, 500);
            }
        });

        function initializeProfile() {
            alert('üöÄ FUNCI√ìN initializeProfile() EJECUT√ÅNDOSE');
            console.log('üöÄ Inicializando perfil...');
            
            // Obtener instancia del juego
            if (window.bingoGame) {
                alert('‚úÖ Juego ya inicializado');
                console.log('‚úÖ Juego ya inicializado, actualizando perfil...');
                updateProfileData();
            } else {
                alert('üö® Creando nueva instancia del juego');
                console.log('üö® No hay instancia del juego, creando una nueva...');
                
                // Crear nueva instancia del juego
                try {
                    window.bingoGame = new BingoPro();
                    alert('‚úÖ BingoPro creado exitosamente');
                    console.log('‚úÖ BingoPro creado exitosamente');
                    
                    // Inicializar el juego
                    window.bingoGame.initializeGame();
                    alert('‚úÖ Juego inicializado');
                    console.log('‚úÖ Juego inicializado, actualizando perfil...');
                    
                    // Actualizar perfil despu√©s de un breve delay
                    setTimeout(() => {
                        updateProfileData();
                    }, 500);
                    
                } catch (error) {
                    alert('‚ùå Error: ' + error.message);
                    console.error('‚ùå Error creando BingoPro:', error);
                }
            }
        }

        async function updateProfileData() {
            console.log('üöÄ Actualizando datos del perfil...');
            
            try {
                // Obtener token de la sesi√≥n
                const sessionData = localStorage.getItem('bingoroyal_session');
                if (!sessionData) {
                    console.log('‚ö†Ô∏è No hay sesi√≥n activa');
                    return;
                }
                
                const session = JSON.parse(sessionData);
                const token = session.token;
                
                if (!token) {
                    console.log('‚ö†Ô∏è No hay token de autorizaci√≥n');
                    return;
                }
                
                // Llamar a la API para obtener datos reales del usuario
                const response = await fetch('/api/user/profile', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.user) {
                    const user = data.user;
                    console.log('‚úÖ Datos del usuario obtenidos:', user);
                    
                    // Actualizar UI con datos reales
                    document.getElementById('profileName').textContent = `${user.firstName} ${user.lastName}`;
                    document.getElementById('userId').textContent = user.id;
                    document.getElementById('userLevel').textContent = user.level;
                    document.getElementById('userExp').textContent = `${user.experience} XP`;
                    document.getElementById('userVip').textContent = user.vipStatus ? 'VIP' : 'Est√°ndar';
                    document.getElementById('userRegDate').textContent = new Date(user.registrationDate).toLocaleDateString('es-ES');
                    
                    // Actualizar estado del perfil
                    const statusElement = document.getElementById('profileStatus');
                    if (user.vipStatus) {
                        statusElement.textContent = 'VIP';
                        statusElement.style.background = 'linear-gradient(45deg, #ffd700, #ffb347)';
                    } else {
                        statusElement.textContent = 'Est√°ndar';
                        statusElement.style.background = 'linear-gradient(45deg, #00d4aa, #0099cc)';
                    }
                    
                    // Estad√≠sticas del juego
                    document.getElementById('totalGames').textContent = user.totalGames;
                    document.getElementById('totalWins').textContent = user.totalWins;
                    document.getElementById('winRate').textContent = user.totalGames > 0 ? `${Math.round((user.totalWins / user.totalGames) * 100)}%` : '0%';
                    document.getElementById('totalCards').textContent = '0'; // Por ahora
                    
                    // Informaci√≥n financiera
                    document.getElementById('userBalance').textContent = `‚Ç¨${user.balance.toFixed(2)}`;
                    document.getElementById('totalSpent').textContent = `‚Ç¨${user.totalSpent.toFixed(2)}`;
                    document.getElementById('totalWon').textContent = `‚Ç¨${user.totalWon.toFixed(2)}`;
                    
                    const netProfit = user.totalWon - user.totalSpent;
                    document.getElementById('netProfit').textContent = `‚Ç¨${netProfit.toFixed(2)}`;
                    document.getElementById('netProfit').style.color = netProfit >= 0 ? '#4ecdc4' : '#ff6b6b';
                    
                    // Logros
                    document.getElementById('achievementsUnlocked').textContent = user.achievements.length;
                    document.getElementById('highestPrize').textContent = `‚Ç¨${user.highestPrize.toFixed(2)}`;
                    document.getElementById('currentStreak').textContent = user.currentStreak;
                    document.getElementById('bestStreak').textContent = user.bestStreak;
                    
                    // Configuraci√≥n
                    document.getElementById('notificationsToggle').checked = user.settings.notifications;
                    document.getElementById('soundsToggle').checked = user.settings.sounds;
                    
                    console.log('‚úÖ Perfil actualizado con datos reales');
                    
                    // ‚ú® NUEVO: Actualizar tambi√©n el header con los datos reales
                    setTimeout(() => {
                        if (typeof updateHeaderUserInfo === 'function') {
                            updateHeaderUserInfo();
                            console.log('‚úÖ Header actualizado con datos reales');
                        }
                    }, 100);
                    
                } else {
                    console.log('‚ö†Ô∏è Error en la respuesta de la API:', data.error);
                }
                
            } catch (error) {
                console.error('‚ùå Error obteniendo datos del perfil:', error);
                
                // Fallback: usar datos del juego si est√° disponible
                const game = window.bingoGame || window.gameInstance;
                if (game) {
                    console.log('üîÑ Usando datos del juego como fallback...');
                    updateProfileDataFromGame(game);
                }
            }
        }
        
        function updateProfileDataFromGame(game) {
            // Informaci√≥n personal
            document.getElementById('profileName').textContent = game.getUserName() || 'Usuario Bingo';
            document.getElementById('userId').textContent = game.getUserId() || 'N/A';
            document.getElementById('userLevel').textContent = game.getUserLevel() || '0';
            document.getElementById('userExp').textContent = game.getUserExperience() || '0 XP';
            document.getElementById('userVip').textContent = game.isUserVip() ? 'VIP' : 'Est√°ndar';
            document.getElementById('userRegDate').textContent = game.getUserRegistrationDate() || 'N/A';

            // Estado del perfil
            const statusElement = document.getElementById('profileStatus');
            if (game.isUserVip()) {
                statusElement.textContent = 'VIP';
                statusElement.style.background = 'linear-gradient(45deg, #ffd700, #ffb347)';
            } else {
                statusElement.textContent = 'Est√°ndar';
                statusElement.style.background = 'linear-gradient(45deg, #00d4aa, #0099cc)';
            }

            // Estad√≠sticas del juego
            document.getElementById('totalGames').textContent = game.getTotalGames() || '0';
            document.getElementById('totalWins').textContent = game.getTotalWins() || '0';
            document.getElementById('winRate').textContent = game.getWinRate() || '0%';
            document.getElementById('totalCards').textContent = game.getTotalCards() || '0';

            // Informaci√≥n financiera
            document.getElementById('userBalance').textContent = `‚Ç¨${(game.userBalance || 0).toFixed(2)}`;
            document.getElementById('totalSpent').textContent = `‚Ç¨${(game.getTotalSpent() || 0).toFixed(2)}`;
            document.getElementById('totalWon').textContent = `‚Ç¨${(game.getTotalWon() || 0).toFixed(2)}`;
            
            const totalSpent = game.getTotalSpent() || 0;
            const totalWon = game.getTotalWon() || 0;
            const netProfit = totalWon - totalSpent;
            document.getElementById('netProfit').textContent = `‚Ç¨${netProfit.toFixed(2)}`;
            document.getElementById('netProfit').style.color = netProfit >= 0 ? '#4ecdc4' : '#ff6b6b';

            // Cartones por modo
            updateCardsByMode(game);

            // Logros
            document.getElementById('achievementsUnlocked').textContent = game.getAchievementsUnlocked() || '0';
            document.getElementById('highestPrize').textContent = `‚Ç¨${(game.getHighestPrize() || 0).toFixed(2)}`;
            document.getElementById('currentStreak').textContent = game.getCurrentStreak() || '0';
            document.getElementById('bestStreak').textContent = game.getBestStreak() || '0';

            // Configuraci√≥n
            document.getElementById('notificationsToggle').checked = game.getNotificationSetting() !== false;
            document.getElementById('soundsToggle').checked = game.getSoundSetting() !== false;
        }

        function updateCardsByMode(game) {
            const cardsByMode = game.getCardsByMode() || {};
            const modes = ['CLASSIC', 'RAPID', 'VIP', 'NIGHT'];
            
            modes.forEach(mode => {
                const count = cardsByMode[mode] || 0;
                const element = document.querySelector(`#cardsByMode .info-item:nth-child(${modes.indexOf(mode) + 1}) .info-value`);
                if (element) {
                    element.textContent = count;
                }
            });
        }

        function saveSettings() {
            const game = window.bingoGame || window.gameInstance;
            if (!game) {
                console.log('‚ö†Ô∏è Instancia del juego no encontrada');
                return;
            }

            const notifications = document.getElementById('notificationsToggle').checked;
            const sounds = document.getElementById('soundsToggle').checked;

            game.setNotificationSetting(notifications);
            game.setSoundSetting(sounds);

            // Mostrar confirmaci√≥n
            showNotification('‚úÖ Configuraci√≥n guardada correctamente', 'success');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#4ecdc4' : '#ff6b6b'};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Estilos para switches
        const style = document.createElement('style');
        style.textContent = `
            .switch {
                position: relative;
                display: inline-block;
                width: 60px;
                height: 34px;
            }
            
            .switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }
            
            .slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: #ccc;
                transition: .4s;
                border-radius: 34px;
            }
            
            .slider:before {
                position: absolute;
                content: "";
                height: 26px;
                width: 26px;
                left: 4px;
                bottom: 4px;
                background-color: white;
                transition: .4s;
                border-radius: 50%;
            }
            
            input:checked + .slider {
                background-color: #4ecdc4;
            }
            
            input:checked + .slider:before {
                transform: translateX(26px);
            }
            
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
